# Bitget çˆ¬è™« Makefile

.PHONY: help install test run clean setup dry-run

# é»˜è®¤ç›®æ ‡
help:
	@echo "Bitget API æ–‡æ¡£çˆ¬è™«"
	@echo "==================="
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  make install    - å®‰è£…ä¾èµ–"
	@echo "  make setup      - å®Œæ•´ç¯å¢ƒè®¾ç½®"
	@echo "  make test       - è¿è¡Œæµ‹è¯•"
	@echo "  make dry-run    - è¯•è¿è¡Œï¼ˆåªçˆ¬å–ç¬¬ä¸€é¡µï¼‰"
	@echo "  make run        - è¿è¡Œçˆ¬è™«"
	@echo "  make run-10     - è¿è¡Œçˆ¬è™«ï¼ˆé™åˆ¶10é¡µï¼‰"
	@echo "  make clean      - æ¸…ç†è¾“å‡ºæ–‡ä»¶"
	@echo "  make help       - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"

# å®‰è£…ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£… Python ä¾èµ–..."
	pip3 install -r requirements.txt
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

# å®Œæ•´ç¯å¢ƒè®¾ç½®
setup: install
	@echo "ğŸ”§ è®¾ç½® crawl4ai ç¯å¢ƒ..."
	crawl4ai-setup
	@echo "ğŸ©º éªŒè¯å®‰è£…..."
	crawl4ai-doctor
	@echo "ğŸ“ åˆ›å»ºè¾“å‡ºç›®å½•..."
	mkdir -p output
	@echo "ğŸ” è®¾ç½®æ‰§è¡Œæƒé™..."
	chmod +x *.py
	@echo "âœ… ç¯å¢ƒè®¾ç½®å®Œæˆ"

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œçˆ¬è™«æµ‹è¯•..."
	python3 test_crawler.py

# è¯•è¿è¡Œ
dry-run:
	@echo "ğŸ”„ è¯•è¿è¡Œçˆ¬è™«ï¼ˆåªçˆ¬å–ç¬¬ä¸€é¡µï¼‰..."
	python3 run.py --dry-run --verbose

# è¿è¡Œçˆ¬è™«
run:
	@echo "ğŸš€ è¿è¡Œçˆ¬è™«..."
	python3 run.py

# è¿è¡Œçˆ¬è™«ï¼ˆé™åˆ¶10é¡µï¼‰
run-10:
	@echo "ğŸš€ è¿è¡Œçˆ¬è™«ï¼ˆé™åˆ¶10é¡µï¼‰..."
	python3 run.py --max-pages 10

# è¿è¡Œçˆ¬è™«ï¼ˆé™åˆ¶20é¡µï¼‰
run-20:
	@echo "ğŸš€ è¿è¡Œçˆ¬è™«ï¼ˆé™åˆ¶20é¡µï¼‰..."
	python3 run.py --max-pages 20

# è¿è¡Œçˆ¬è™«ï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰
run-verbose:
	@echo "ğŸš€ è¿è¡Œçˆ¬è™«ï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰..."
	python3 run.py --verbose

# æ¸…ç†è¾“å‡ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†è¾“å‡ºæ–‡ä»¶..."
	rm -rf output/*.json
	rm -rf output/*.log
	@echo "âœ… æ¸…ç†å®Œæˆ"

# æŸ¥çœ‹æœ€æ–°ç»“æœ
show-latest:
	@echo "ğŸ“„ æ˜¾ç¤ºæœ€æ–°çˆ¬å–ç»“æœ..."
	@latest_file=$$(ls -t output/bitget_docs_*.json 2>/dev/null | head -1); \
	if [ -n "$$latest_file" ]; then \
		echo "æœ€æ–°æ–‡ä»¶: $$latest_file"; \
		echo "æ–‡ä»¶å¤§å°: $$(du -h "$$latest_file" | cut -f1)"; \
		echo "é¡µé¢æ•°é‡: $$(jq length "$$latest_file")"; \
		echo "å‰3é¡µæ ‡é¢˜:"; \
		jq -r '.[0:3][] | "  - " + .title' "$$latest_file"; \
	else \
		echo "âŒ æ²¡æœ‰æ‰¾åˆ°ç»“æœæ–‡ä»¶"; \
	fi

# æŸ¥çœ‹æ—¥å¿—
show-log:
	@echo "ğŸ“‹ æ˜¾ç¤ºæœ€æ–°æ—¥å¿—..."
	@latest_log=$$(ls -t output/crawler_*.log 2>/dev/null | head -1); \
	if [ -n "$$latest_log" ]; then \
		echo "æœ€æ–°æ—¥å¿—: $$latest_log"; \
		tail -20 "$$latest_log"; \
	else \
		echo "âŒ æ²¡æœ‰æ‰¾åˆ°æ—¥å¿—æ–‡ä»¶"; \
	fi

# æ£€æŸ¥çŠ¶æ€
status:
	@echo "ğŸ“Š çˆ¬è™«çŠ¶æ€"
	@echo "============"
	@echo "Python ç‰ˆæœ¬: $$(python3 --version)"
	@echo "å·¥ä½œç›®å½•: $$(pwd)"
	@echo "Schema æ–‡ä»¶: $$(if [ -f schema.json ]; then echo 'âœ… å­˜åœ¨'; else echo 'âŒ ä¸å­˜åœ¨'; fi)"
	@echo "è¾“å‡ºç›®å½•: $$(if [ -d output ]; then echo 'âœ… å­˜åœ¨'; else echo 'âŒ ä¸å­˜åœ¨'; fi)"
	@echo "ç»“æœæ–‡ä»¶æ•°: $$(ls output/bitget_docs_*.json 2>/dev/null | wc -l)"
	@echo "æ—¥å¿—æ–‡ä»¶æ•°: $$(ls output/crawler_*.log 2>/dev/null | wc -l)"

# å¿«é€Ÿå¼€å§‹
quick-start: setup test dry-run
	@echo ""
	@echo "ğŸ‰ å¿«é€Ÿå¼€å§‹å®Œæˆï¼"
	@echo "ç°åœ¨å¯ä»¥è¿è¡Œ: make run"